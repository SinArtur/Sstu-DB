# Changelog - Модуль расписания

## [1.0.0] - 2026-01-07

### Добавлено

#### Backend
- ✅ Новое Django приложение `schedule` с полным набором моделей:
  - `Institute` - институты СГТУ
  - `Group` - учебные группы
  - `Teacher` - преподаватели
  - `Subject` - учебные предметы
  - `Lesson` - занятия в расписании
  - `ScheduleUpdate` - история обновлений расписания

- ✅ Парсер расписания (`schedule/parser.py`):
  - Автоматический парсинг главной страницы rasp.sstu.ru
  - Парсинг расписания групп с поддержкой всех типов занятий
  - Извлечение данных о преподавателях, аудиториях, времени занятий
  - Поддержка экзаменов с конкретными датами
  - Обработка ошибок и логирование

- ✅ Сервис синхронизации (`schedule/services.py`):
  - Полная синхронизация всех групп и расписаний
  - Частичная синхронизация отдельных групп
  - Автоматическое обновление данных без потери старых
  - Статистика синхронизации

- ✅ Celery задачи (`schedule/tasks.py`):
  - `sync_all_schedules` - полная синхронизация
  - `sync_single_group` - синхронизация одной группы
  - Автоматический запуск каждые 3 часа

- ✅ Настройка Celery (`config/celery.py`):
  - Конфигурация Celery Beat
  - Периодические задачи
  - Таймауты и лимиты

- ✅ REST API эндпоинты (`schedule/views.py`, `schedule/serializers.py`):
  - `GET /api/schedule/institutes/` - список институтов
  - `GET /api/schedule/groups/` - список групп с фильтрацией
  - `GET /api/schedule/groups/my_group/` - группа текущего пользователя
  - `GET /api/schedule/teachers/` - список преподавателей
  - `GET /api/schedule/subjects/` - список предметов
  - `GET /api/schedule/lessons/` - список занятий с фильтрацией
  - `GET /api/schedule/lessons/my_schedule/` - персональное расписание
  - `GET /api/schedule/lessons/weekly/?group={id}` - недельное расписание группы
  - `GET /api/schedule/updates/` - история обновлений
  - `POST /api/schedule/updates/trigger_sync/` - запуск синхронизации

- ✅ Management команда:
  - `python manage.py sync_schedule` - ручная синхронизация
  - `python manage.py sync_schedule --group {id}` - синхронизация одной группы

- ✅ Админ-панель Django:
  - Управление институтами, группами, преподавателями
  - Просмотр и редактирование занятий
  - Мониторинг обновлений расписания

- ✅ Модель User расширена:
  - Добавлено поле `group` - связь с группой студента
  - Миграция для добавления поля

#### Frontend
- ✅ Новая страница расписания (`pages/SchedulePage.tsx`):
  - Красивый интерфейс в стиле существующего дизайна
  - Отображение расписания по дням недели
  - Цветовая кодировка типов занятий (лекции, практики, лабораторные, экзамены)
  - Информация о времени, преподавателях, аудиториях
  - Адаптивный дизайн

- ✅ Функционал поиска и фильтрации:
  - Поиск по предметам, преподавателям, аудиториям
  - Фильтрация по институтам
  - Фильтрация по группам
  - Фильтрация по дням недели
  - Мгновенный поиск без перезагрузки

- ✅ Выбор группы в профиле (`pages/ProfilePage.tsx`):
  - Выбор института
  - Выбор группы из выбранного института
  - Сохранение выбора
  - Отображение текущей группы

- ✅ Интеграция в навигацию:
  - Добавлена ссылка "Расписание" в сайдбар
  - Иконка календаря
  - Автоматическое отображение расписания выбранной группы

- ✅ API клиент (`lib/api.ts`):
  - Функции для работы с расписанием
  - Типизация TypeScript
  - Обработка ошибок

#### Зависимости
- ✅ `beautifulsoup4==4.12.2` - парсинг HTML
- ✅ `requests==2.31.0` - HTTP запросы
- ✅ `celery==5.3.4` - асинхронные задачи (уже было)
- ✅ `redis==5.0.1` - брокер для Celery (уже было)

#### Документация
- ✅ `backend/schedule/README.md` - подробная документация модуля
- ✅ `SCHEDULE_SETUP.md` - полная инструкция по настройке
- ✅ `QUICK_START_SCHEDULE.md` - быстрый старт
- ✅ `CHANGELOG_SCHEDULE.md` - история изменений
- ✅ Обновлен главный `README.md` с информацией о расписании

### Изменено
- Обновлен `backend/requirements.txt` - добавлены зависимости для парсинга
- Обновлен `backend/config/settings.py` - добавлено приложение `schedule`
- Обновлен `backend/config/urls.py` - добавлены URL расписания
- Обновлен `frontend/src/App.tsx` - добавлен роут `/schedule`
- Обновлен `frontend/src/components/Sidebar.tsx` - добавлена ссылка на расписание
- Обновлена модель `User` - добавлено поле `group`
- Обновлены сериализаторы `accounts` - добавлена информация о группе

### Технические детали
- **Парсинг:** BeautifulSoup4 для обработки HTML с сайта СГТУ
- **Периодичность:** Автоматическое обновление каждые 3 часа через Celery Beat
- **Хранение:** PostgreSQL для надежного хранения расписания
- **Кэширование:** Использование старых данных при недоступности сайта СГТУ
- **API:** RESTful API с пагинацией, фильтрацией и поиском
- **Типизация:** Полная типизация TypeScript для фронтенда
- **Стилизация:** Tailwind CSS в соответствии с существующим дизайном

### Особенности реализации
1. **Устойчивость к сбоям:** Если сайт СГТУ недоступен, старые данные остаются в БД
2. **Постепенное обновление:** Расписание обновляется по группам, не блокируя систему
3. **Гибкая фильтрация:** Множество параметров для точного поиска нужных занятий
4. **Персонализация:** Каждый студент может выбрать свою группу
5. **Масштабируемость:** Celery позволяет обрабатывать большие объемы данных
6. **Мониторинг:** История обновлений позволяет отслеживать работу парсера

### Файлы
Создано/изменено **30+ файлов**:
- Backend: 15 файлов
- Frontend: 4 файла
- Документация: 4 файла
- Миграции: 2 файла
- Конфигурация: 5 файлов

### Миграции
- `schedule/migrations/0001_initial.py` - создание таблиц расписания
- `accounts/migrations/0007_user_group.py` - добавление поля group в User
- `branches/migrations/0004_alter_branch_type.py` - обновление типов веток

## Планы на будущее

### В разработке
- [ ] Уведомления об изменениях в расписании
- [ ] Экспорт в iCal/Google Calendar
- [ ] Push-уведомления о предстоящих занятиях
- [ ] Мобильное приложение

### Идеи
- [ ] Статистика посещаемости
- [ ] Интеграция с системой оценок
- [ ] Карта корпусов и аудиторий
- [ ] Информация о преподавателях (контакты, публикации)
- [ ] Форум для обсуждения занятий

## Благодарности
- СГТУ за открытый доступ к расписанию на rasp.sstu.ru
- Разработчикам BeautifulSoup4, Django, React и других используемых библиотек

---

**Версия:** 1.0.0  
**Дата:** 7 января 2026  
**Статус:** Стабильный релиз ✅

