# Скрипт для автоматической синхронизации расписания

Этот скрипт позволяет автоматически синхронизировать расписание с вашего компьютера.

## Установка

1. **Установите Python 3.8+** (если еще не установлен)

2. **Установите зависимости:**
   ```bash
   pip install -r requirements_sync_client.txt
   ```

3. **Создайте файл `.env`:**
   - Скопируйте `schedule_sync_client.env.example` в `.env`
   - Заполните необходимые данные (см. ниже)

## Настройка

### Получение токена доступа

1. Войдите на сайт как администратор
2. Откройте консоль браузера (F12)
3. Перейдите на вкладку **Application** (Chrome) или **Storage** (Firefox)
4. Найдите **Local Storage** -> ваш домен
5. Найдите ключ `auth-storage` и откройте его
6. Скопируйте значение `accessToken`

### Настройка .env файла

```env
# URL вашего API (замените на реальный адрес сервера)
API_BASE_URL=https://your-server.com/api

# Токен доступа (вставьте скопированный токен)
API_TOKEN=your_access_token_here

# Интервал синхронизации в часах (по умолчанию 3)
SYNC_INTERVAL_HOURS=3

# Уровень логирования
LOG_LEVEL=INFO
```

## Использование

### Однократный запуск

```bash
python schedule_sync_client.py --once
```

### Запуск с автоматическим расписанием

```bash
python schedule_sync_client.py
```

Скрипт будет синхронизировать расписание каждые 3 часа (или как указано в `SYNC_INTERVAL_HOURS`).

## Автозапуск на Windows

### Вариант 1: Планировщик заданий Windows

1. Откройте **Планировщик заданий** (Task Scheduler)
2. Создайте новую задачу
3. Настройте:
   - **Триггер:** При входе в систему (или по расписанию)
   - **Действие:** Запустить программу
   - **Программа:** `python.exe` (полный путь, например: `C:\Python311\python.exe`)
   - **Аргументы:** `"C:\путь\к\schedule_sync_client.py"`
   - **Рабочая папка:** `C:\путь\к\папке\со\скриптом`
4. В разделе **Условия** снимите галочку "Останавливать задачу, если компьютер переходит в режим ожидания"
5. В разделе **Параметры** выберите "Запускать задачу немедленно, если пропущен запланированный запуск"

### Вариант 2: NSSM (Non-Sucking Service Manager)

NSSM позволяет запустить Python скрипт как службу Windows.

1. **Скачайте NSSM:** https://nssm.cc/download
2. **Распакуйте** в папку (например, `C:\nssm`)
3. **Откройте командную строку от имени администратора**
4. **Установите службу:**
   ```cmd
   cd C:\nssm\win64
   nssm install ScheduleSync "C:\Python311\python.exe" "C:\путь\к\schedule_sync_client.py"
   ```
5. **Настройте службу:**
   ```cmd
   nssm set ScheduleSync AppDirectory "C:\путь\к\папке\со\скриптом"
   nssm set ScheduleSync Description "Автоматическая синхронизация расписания СГТУ"
   ```
6. **Запустите службу:**
   ```cmd
   nssm start ScheduleSync
   ```

### Вариант 3: Ярлык в автозагрузке

1. Создайте ярлык для скрипта
2. Поместите его в папку автозагрузки:
   - Нажмите `Win + R`
   - Введите `shell:startup`
   - Скопируйте ярлык в открывшуюся папку

## Логи

Логи сохраняются в папке `logs/schedule_sync.log` в той же директории, где находится скрипт.

## Устранение проблем

### Ошибка "API_TOKEN не установлен"
- Убедитесь, что файл `.env` существует в той же папке, что и скрипт
- Проверьте, что токен скопирован правильно (без лишних пробелов)

### Ошибка "Ошибка доступа: У вас нет прав администратора"
- Убедитесь, что вы используете токен администратора
- Проверьте, что токен не истек (токены JWT имеют срок действия)

### Ошибка "Не удалось подключиться к API"
- Проверьте, что `API_BASE_URL` указан правильно
- Убедитесь, что сервер доступен с вашего компьютера
- Проверьте файрвол и сетевые настройки

### Скрипт не запускается автоматически
- Проверьте логи в `logs/schedule_sync.log`
- Убедитесь, что Python установлен и доступен из командной строки
- Проверьте права доступа к файлам

## Обновление токена

Токены JWT имеют срок действия. Если токен истек:

1. Войдите на сайт заново
2. Получите новый токен (см. раздел "Получение токена доступа")
3. Обновите `API_TOKEN` в файле `.env`
4. Перезапустите скрипт или службу

## Безопасность

⚠️ **ВАЖНО:** Файл `.env` содержит секретный токен. Не публикуйте его в Git и не передавайте другим людям!

Добавьте `.env` в `.gitignore`:
```
.env
logs/
```

